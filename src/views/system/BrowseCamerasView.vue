<script setup>
import AppLayout from '@/components/layout/AppLayout.vue'
import { ref, onMounted } from 'vue'

const cameras = ref([]) // Full list of cameras
const filteredCameras = ref([]) // Filtered list of cameras based on availability
const cameraFilter = ref('all') // Track the current filter state
const page = ref(1) // Current page for pagination
const totalPages = ref(1) // Total number of pages for pagination
const cart = ref([]) // Cart array to store added cameras
const selectedCamera = ref(null) // To store the camera details for the modal
const dialog = ref(false) // To control the visibility of the dialog

// Mock camera data (can be fetched from an API)
const mockCameras = [
  {
    id: 1,
    name: 'Canon EOS R5',
    description: 'High-end mirrorless camera',
    image: '/public/images/sample-camera.jpg',
    price: 100,
    isAvailable: true,
  },
  {
    id: 2,
    name: 'Nikon D850',
    description: 'Full-frame DSLR',
    image: '/public/images/sample-camera.jpg',
    price: 80,
    isAvailable: false,
  },
  {
    id: 3,
    name: 'Sony A7 III',
    description: 'Popular mirrorless camera',
    image: '/public/images/sample-camera.jpg',
    price: 90,
    isAvailable: true,
  },
  {
    id: 4,
    name: 'Fujifilm X-T4',
    description: 'Compact mirrorless camera',
    image: '/public/images/sample-camera.jpg',
    price: 70,
    isAvailable: false,
  },
  {
    id: 5,
    name: 'Fujifilm X-T4',
    description: 'Compact mirrorless camera',
    image: '/public/images/sample-camera.jpg',
    price: 70,
    isAvailable: false,
  },
  {
    id: 6,
    name: 'Fujifilm X-T4',
    description: 'Compact mirrorless camera',
    image: '/public/images/sample-camera.jpg',
    price: 70,
    isAvailable: false,
  },
]

const fetchCameras = () => {
  const camerasPerPage = 4
  filteredCameras.value = mockCameras.slice(
    (page.value - 1) * camerasPerPage,
    page.value * camerasPerPage,
  )
  totalPages.value = Math.ceil(mockCameras.length / camerasPerPage)
}

const filterCameras = (filter) => {
  cameraFilter.value = filter
  if (filter === 'available') {
    filteredCameras.value = mockCameras.filter((camera) => camera.isAvailable)
  } else if (filter === 'unavailable') {
    filteredCameras.value = mockCameras.filter((camera) => !camera.isAvailable)
  } else {
    filteredCameras.value = mockCameras
  }
}

const viewCamera = (id) => {
  selectedCamera.value = mockCameras.find((camera) => camera.id === id) // Set the selected camera
  dialog.value = true // Open the dialog
}

const addToCart = (camera) => {
  // Check if the camera is already in the cart
  const existingCamera = cart.value.find((item) => item.id === camera.id)
  if (!existingCamera) {
    cart.value.push(camera)
  }
  console.log('Camera added to cart:', camera)
}

onMounted(() => {
  fetchCameras()
  filterCameras(cameraFilter.value) // Apply the initial filter
})
</script>

<template>
  <AppLayout>
    <template #content>
      <v-container>
        <!-- Filter Buttons -->
        <v-row class="mb-4">
          <v-col>
            <v-btn
              color="primary"
              @click="filterCameras('available')"
              :class="{ 'v-btn--active': cameraFilter === 'available' }"
            >
              Show Available Cameras
            </v-btn>
          </v-col>
          <v-col>
            <v-btn
              color="error"
              @click="filterCameras('unavailable')"
              :class="{ 'v-btn--active': cameraFilter === 'unavailable' }"
            >
              Show Unavailable Cameras
            </v-btn>
          </v-col>
          <v-col>
            <v-btn
              color="default"
              @click="filterCameras('all')"
              :class="{ 'v-btn--active': cameraFilter === 'all' }"
            >
              Show All Cameras
            </v-btn>
          </v-col>
        </v-row>

        <!-- Camera Cards -->
        <v-row>
          <v-col v-for="camera in filteredCameras" :key="camera.id" cols="12" sm="6" md="4">
            <v-card>
              <!-- Camera Image -->
              <v-img
                :src="camera.image"
                height="200px"
                alt="Camera Image"
                class="white--text align-end"
              >
                <v-card-title>{{ camera.name }}</v-card-title>
              </v-img>

              <!-- Camera Description -->
              <v-card-subtitle>
                <span>{{ camera.description }}</span>
              </v-card-subtitle>

              <!-- Card Actions (Buttons) -->
              <v-card-actions class="d-flex justify-space-between ma-3">
                <v-btn color="primary" class="w-50" @click="viewCamera(camera.id)">
                  View Details
                </v-btn>
                <v-btn
                  color="success"
                  class="w-50"
                  @click="addToCart(camera)"
                  :disabled="!camera.isAvailable"
                >
                  Add to Cart
                </v-btn>
              </v-card-actions>

              <!-- Camera Price and Availability -->
              <v-card-footer class="d-flex justify-space-between ma-5">
                <span class="text-h6">â‚±{{ camera.price }} / day</span>
                <v-chip :color="camera.isAvailable ? 'green' : 'red'" text-color="white">
                  {{ camera.isAvailable ? 'Available' : 'Unavailable' }}
                </v-chip>
              </v-card-footer>
            </v-card>
          </v-col>
        </v-row>

        <!-- Camera Details Modal -->
        <v-dialog v-model="dialog" max-width="600px">
          <v-card>
            <v-card-title class="d-flex justify-space-between">
              <span class="text-h5">{{ selectedCamera?.name }}</span>
            </v-card-title>
            <v-card-subtitle>
              <span>{{ selectedCamera?.description }}</span>
            </v-card-subtitle>
            <v-card-actions> </v-card-actions>
          </v-card>
        </v-dialog>
        <!-- Pagination -->
        <v-pagination
          v-if="filteredCameras.length > 0"
          v-model="page"
          :length="totalPages"
          @input="fetchCameras"
        />
      </v-container>
    </template>
  </AppLayout>
</template>
